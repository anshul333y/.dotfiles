#!/bin/bash

# Config
LIMIT=30
SAVE_DIR="$HOME/Pictures/Wallpapers"
RESOLUTION="1920x1080"
CATEGORIES="111" # General + Anime + People
PURITY="100"     # SFW only
SORTING="random" # ðŸŽ² Random wallpapers
ORDER="desc"     # Not used with 'random', but kept for completeness

# Create directory if it doesn't exist
mkdir -p "$SAVE_DIR"

# Fetch wallpapers
echo "Fetching random wallpapers from Wallhaven..."
RESPONSE=$(curl -sG "https://wallhaven.cc/api/v1/search" \
    --data-urlencode "categories=$CATEGORIES" \
    --data-urlencode "purity=$PURITY" \
    --data-urlencode "resolutions=$RESOLUTION" \
    --data-urlencode "sorting=$SORTING" \
    --data-urlencode "page=1")

# Extract image URLs using jq
IMAGE_URLS=$(echo "$RESPONSE" | jq -r '.data[].path')

# Read into array
mapfile -t URLS <<<"$IMAGE_URLS"

# Download wallpapers
for ((i = 0; i < LIMIT && i < ${#URLS[@]}; i++)); do
    URL="${URLS[$i]}"
    FILENAME=$(basename "$URL")
    echo "[$((i + 1))/$LIMIT] Downloading $FILENAME ..."
    curl -s "$URL" -o "$SAVE_DIR/$FILENAME"
done

echo "âœ… Download complete! Saved to $SAVE_DIR"
